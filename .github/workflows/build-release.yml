name: Build iOS Release (manual only)

on:
  workflow_dispatch:

jobs:
  build-ios:
    runs-on: macos-26

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Xcode 26
        uses: maxim-lobanov/setup-xcode@v1
        with:
          xcode-version: '26.0'

      - name: Install xcodegen
        run: |
          brew install xcodegen

      - name: Generate Xcode project
        run: |
          xcodegen

      - name: Build Release archive (no signing)
        run: |
          xcodebuild archive \
           -scheme "Pocket Poster" \
           -configuration Release \
           -destination "generic/platform=iOS" \
           -archivePath build/PocketPoster.xcarchive \
           CODE_SIGNING_ALLOWED=NO

      - name: Upload xcarchive
        uses: actions/upload-artifact@v4
        with:
          name: PocketPoster-xcarchive
          path: build/PocketPoster.xcarchive
